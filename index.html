<!DOCTYPE html>
<html lang="th">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>à¸£à¸°à¸šà¸šà¹‚à¸«à¸§à¸•à¹€à¸ªà¸·à¹‰à¸­à¸à¸µà¸¬à¸²à¸ªà¸µ</title>
Â  Â  <link rel="stylesheet" href="style.css">
Â  Â  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
Â  Â  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
Â  Â  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
Â  Â  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
</head>
<body>
Â  Â  <div class="announcement-bar">
Â  Â  Â  Â  <p class="scrolling-text">
Â  Â  Â  Â  Â  Â  ğŸ“£ à¸¢à¸´à¸™à¸”à¸µà¸•à¹‰à¸­à¸™à¸£à¸±à¸šà¸ªà¸¹à¹ˆà¸à¸²à¸£à¹‚à¸«à¸§à¸•à¹€à¸ªà¸·à¹‰à¸­à¸à¸µà¸¬à¸²à¸ªà¸µ à¸›à¸£à¸°à¸ˆà¸³à¸›à¸µà¸à¸²à¸£à¸¨à¸¶à¸à¸©à¸² 2568 â€¼ï¸ à¸‚à¸­à¹ƒà¸«à¹‰à¸™à¸±à¸à¹€à¸£à¸µà¸¢à¸™à¸—à¸¸à¸à¸„à¸™à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹à¸¥à¸°à¸£à¸±à¸à¸©à¸²à¸ªà¸´à¸—à¸˜à¸´à¹Œà¸‚à¸­à¸‡à¸•à¸™à¹€à¸­à¸‡ â€¼ï¸ à¸«à¸²à¸à¸à¸šà¸›à¸±à¸à¸«à¸²à¹ƒà¸™à¸à¸²à¸£à¹‚à¸«à¸§à¸• à¹„à¸¡à¹ˆà¸à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸™à¸±à¸à¹€à¸£à¸µà¸¢à¸™ à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸™à¸±à¸à¹€à¸£à¸µà¸¢à¸™à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡ à¸à¸£à¸¸à¸“à¸²à¸•à¸´à¸”à¸•à¹ˆà¸­ Facebook : à¸ªà¸ à¸²à¸™à¸±à¸à¹€à¸£à¸µà¸¢à¸™à¹‚à¸£à¸‡à¹€à¸£à¸µà¸¢à¸™à¸ à¸¹à¸«à¸¥à¸§à¸‡à¸§à¸´à¸—à¸¢à¸² IG : sapaplw_67 â€¼ï¸
Â  Â  Â  Â  </p>
Â  Â  </div>

Â  Â  <div class="container">
Â  Â  Â  Â  <header>
Â  Â  Â  Â  Â  Â  <img src="https://img5.pic.in.th/file/secure-sv1/IMG_60290ec6a71fd92a13d0.png" alt="à¹‚à¸¥à¹‚à¸à¹‰à¹‚à¸£à¸‡à¹€à¸£à¸µà¸¢à¸™" class="logo">
Â  Â  Â  Â  Â  Â  <h1>à¹‚à¸«à¸§à¸•à¹à¸šà¸šà¹€à¸ªà¸·à¹‰à¸­à¸à¸µà¸¬à¸²à¸ªà¸µ</h1>
Â  Â  Â  Â  </header>

Â  Â  Â  Â  <div id="voting-status" class="status-message"></div>
Â  Â  Â  Â  <div id="countdown-timer" style="display: none;"></div>

Â  Â  Â  Â  <div id="registration-form-section" class="form-section">
Â  Â  Â  Â  Â  Â  <h2>à¸à¸£à¸­à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸à¸·à¹ˆà¸­à¹‚à¸«à¸§à¸•</h2>
Â  Â  Â  Â  Â  Â  <form id="voteForm">
Â  Â  Â  Â  Â  Â  Â  Â  <label for="studentId">à¸£à¸«à¸±à¸ªà¸™à¸±à¸à¹€à¸£à¸µà¸¢à¸™:</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="studentId" name="studentId" required maxlength="5" pattern="0[0-9]{4}" inputmode="numeric" placeholder="à¸à¸£à¸­à¸à¸£à¸«à¸±à¸ªà¸™à¸±à¸à¹€à¸£à¸µà¸¢à¸™ 5 à¸«à¸¥à¸±à¸ à¹à¸¥à¹‰à¸§à¸à¸” Enter à¸«à¸£à¸·à¸­à¸„à¸¥à¸´à¸à¸—à¸µà¹ˆà¸­à¸·à¹ˆà¸™">
Â  Â  Â  Â  Â  Â  Â  Â  <p id="student-id-msg" class="message" style="margin-top:-10px; margin-bottom:15px;"></p>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <label for="fullName">à¸Šà¸·à¹ˆà¸­-à¸™à¸²à¸¡à¸ªà¸à¸¸à¸¥:</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="fullName" name="fullName" readonly style="background-color: #e9ecef;">
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <label for="grade">à¸£à¸°à¸”à¸±à¸šà¸Šà¸±à¹‰à¸™:</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="grade" name="grade" readonly style="background-color: #e9ecef;">
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <label for="room">à¸«à¹‰à¸­à¸‡:</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="room" name="room" readonly style="background-color: #e9ecef;">

Â  Â  Â  Â  Â  Â  Â  Â  <label>à¹€à¸¥à¸·à¸­à¸à¹à¸šà¸šà¹€à¸ªà¸·à¹‰à¸­:</label>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="design-options" class="design-options disabled">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" id="submitVoteButton" disabled>à¸¢à¸·à¸™à¸¢à¸±à¸™à¸à¸²à¸£à¹‚à¸«à¸§à¸•</button>
Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="results-section" style="display: none;">
Â  Â  Â  Â  Â  Â  <h2>à¸œà¸¥à¸à¸²à¸£à¹‚à¸«à¸§à¸•</h2>
Â  Â  Â  Â  Â  Â  <div class="chart-container" style="width: 100%; height: 350px; margin: 20px auto;">
Â  Â  Â  Â  Â  Â  Â  Â  <canvas id="voteChart"></canvas>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <p id="chart-message" class="message"></p>
Â  Â  Â  Â  Â  Â  <div id="vote-results" class="vote-results">
Â  Â  Â  Â  Â  Â  Â  Â  <p>à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”à¸œà¸¥à¹‚à¸«à¸§à¸•...</p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <footer class="footer">
Â  Â  Â  Â  <p>
Â  Â  Â  Â  Â  Â  &copy;2025 Student Council of Phu Luang Witthaya School
Â  Â  Â  Â  Â  Â  <a href="https://www.facebook.com/plwsc.official" target="_blank" rel="noopener noreferrer">
Â  Â  Â  Â  Â  Â  Â  Â  <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b8/2021_Facebook_icon.svg/100px-2021_Facebook_icon.svg.png" alt="Facebook" class="social-icon">
Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  Â  <a href="https://www.instagram.com/plwsc.official?igsh=OWowOWlnNHV4ZXJ2" target="_blank" rel="noopener noreferrer">
Â  Â  Â  Â  Â  Â  Â  Â  <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e7/Instagram_logo_2016.svg/100px-Instagram_logo_2016.png" alt="Instagram" class="social-icon">
Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  Â  <span style="margin: 0 10px;">|</span> <a href="admin.html" style="text-decoration: none;">Admin Login</a>
Â  Â  Â  Â  </p>
Â  Â  </footer>

Â  Â  <script>
Â  Â  Â  Â  const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbwyzu9KVf1X3mY-1-svBPzsR8qFUc0IaG7Vh1A2RUmjo-7AN9IW8Ra_4Io_TfXCSyxRkw/exec';Â 

Â  Â  Â  Â  const voteForm = document.getElementById('voteForm');
Â  Â  Â  Â  const designOptionsDiv = document.getElementById('design-options');
Â  Â  Â  Â  const studentIdInput = document.getElementById('studentId');
Â  Â  Â  Â  const studentIdMsg = document.getElementById('student-id-msg');
Â  Â  Â  Â  const fullNameInput = document.getElementById('fullName');
Â  Â  Â  Â  const gradeInput = document.getElementById('grade');
Â  Â  Â  Â  const roomInput = document.getElementById('room');
Â  Â  Â  Â  const submitVoteButton = document.getElementById('submitVoteButton');
Â  Â  Â  Â  const votingStatusDiv = document.getElementById('voting-status');
Â  Â  Â  Â  const countdownTimerDiv = document.getElementById('countdown-timer');
Â  Â  Â  Â  const registrationFormSection = document.getElementById('registration-form-section');
Â  Â  Â  Â  const resultsSection = document.getElementById('results-section');
Â  Â  Â  Â  const voteResultsDiv = document.getElementById('vote-results');
Â  Â  Â  Â  const chartMessageDiv = document.getElementById('chart-message');
Â  Â  Â  Â  let voteChartInstance = null;
Â  Â  Â  Â  let countdownInterval;

Â  Â  Â  Â  function showSkeletonLoader() {
Â  Â  Â  Â  Â  Â  designOptionsDiv.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="skeleton-card"><div class="skeleton-img"></div><div class="skeleton-text"></div></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="skeleton-card"><div class="skeleton-img"></div><div class="skeleton-text"></div></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="skeleton-card"><div class="skeleton-img"></div><div class="skeleton-text"></div></div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  designOptionsDiv.classList.add('disabled');
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  studentIdInput.addEventListener('blur', async () => {
Â  Â  Â  Â  Â  Â  const id = studentIdInput.value;
Â  Â  Â  Â  Â  Â  studentIdMsg.style.display = 'block';
Â  Â  Â  Â  Â  Â  const resetFields = () => {
Â  Â  Â  Â  Â  Â  Â  Â  fullNameInput.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  gradeInput.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  roomInput.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  designOptionsDiv.classList.add('disabled');
Â  Â  Â  Â  Â  Â  Â  Â  validateForm();
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  if (id.length === 5 && id.startsWith('0')) {
Â  Â  Â  Â  Â  Â  Â  Â  studentIdMsg.textContent = 'à¸à¸³à¸¥à¸±à¸‡à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š...';
Â  Â  Â  Â  Â  Â  Â  Â  studentIdMsg.className = 'message loading';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const result = await callApi('getStudentDetails', { studentId: id });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (result.status === 'success') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  studentIdMsg.textContent = 'à¸à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸™à¸±à¸à¹€à¸£à¸µà¸¢à¸™';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  studentIdMsg.className = 'message success';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fullNameInput.value = result.fullName;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gradeInput.value = result.grade;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  roomInput.value = result.room;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  designOptionsDiv.classList.remove('disabled');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  validateForm();
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  studentIdMsg.textContent = result.message;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  studentIdMsg.className = 'message error';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  resetFields();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } else if (id.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  studentIdMsg.textContent = 'à¸£à¸¹à¸›à¹à¸šà¸šà¸£à¸«à¸±à¸ªà¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡';
Â  Â  Â  Â  Â  Â  Â  Â  studentIdMsg.className = 'message error';
Â  Â  Â  Â  Â  Â  Â  Â  resetFields();
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  studentIdMsg.textContent = '';
Â  Â  Â  Â  Â  Â  Â  Â  studentIdMsg.className = 'message';
Â  Â  Â  Â  Â  Â  Â  Â  studentIdMsg.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  resetFields();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  voteForm.addEventListener('submit', async (event) => {
Â  Â  Â  Â  Â  Â  event.preventDefault();
Â  Â  Â  Â  Â  Â  const studentId = studentIdInput.value;
Â  Â  Â  Â  Â  Â  const voteChoiceElement = document.querySelector('input[name="voteChoice"]:checked');
Â  Â  Â  Â  Â  Â  const voteChoiceValue = voteChoiceElement.value;
Â  Â  Â  Â  Â  Â  const voteChoiceName = document.querySelector(`label[for="design-${voteChoiceValue}"]`).textContent.trim();

Â  Â  Â  Â  Â  Â  Swal.fire({
Â  Â  Â  Â  Â  Â  Â  Â  title: 'à¸¢à¸·à¸™à¸¢à¸±à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥',
Â  Â  Â  Â  Â  Â  Â  Â  html: `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>à¹‚à¸›à¸£à¸”à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸à¹ˆà¸­à¸™à¸¢à¸·à¸™à¸¢à¸±à¸™</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="text-align: left; margin: 0 auto; display: inline-block;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <strong>à¸£à¸«à¸±à¸ªà¸™à¸±à¸à¹€à¸£à¸µà¸¢à¸™:</strong> ${studentId}<br>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <strong>à¸Šà¸·à¹ˆà¸­:</strong> ${fullNameInput.value}<br>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <strong>à¸£à¸°à¸”à¸±à¸šà¸Šà¸±à¹‰à¸™:</strong> ${gradeInput.value}<br>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <strong>à¸«à¹‰à¸­à¸‡:</strong> ${roomInput.value}<br>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <strong>à¸„à¸¸à¸“à¹€à¸¥à¸·à¸­à¸:</strong> ${voteChoiceName}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `,
Â  Â  Â  Â  Â  Â  Â  Â  icon: 'question',
Â  Â  Â  Â  Â  Â  Â  Â  showCancelButton: true,
Â  Â  Â  Â  Â  Â  Â  Â  confirmButtonColor: '#3085d6',
Â  Â  Â  Â  Â  Â  Â  Â  cancelButtonColor: '#d33',
Â  Â  Â  Â  Â  Â  Â  Â  confirmButtonText: 'à¸¢à¸·à¸™à¸¢à¸±à¸™à¸à¸²à¸£à¹‚à¸«à¸§à¸•',
Â  Â  Â  Â  Â  Â  Â  Â  cancelButtonText: 'à¹à¸à¹‰à¹„à¸‚à¸‚à¹‰à¸­à¸¡à¸¹à¸¥'
Â  Â  Â  Â  Â  Â  }).then(async (result) => {
Â  Â  Â  Â  Â  Â  Â  Â  if (result.isConfirmed) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Swal.fire({ title: 'à¸à¸³à¸¥à¸±à¸‡à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥...', text: 'à¸à¸£à¸¸à¸“à¸²à¸£à¸­à¸ªà¸±à¸à¸„à¸£à¸¹à¹ˆ', allowOutsideClick: false, didOpen: () => Swal.showLoading() });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = { studentId: studentId, voteChoice: voteChoiceValue };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const apiResult = await callApi('registerAndVote', data);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (apiResult.status === 'success') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confetti({ particleCount: 150, spread: 180, origin: { y: 0.6 } });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Swal.fire({ title: 'à¹‚à¸«à¸§à¸•à¸ªà¸³à¹€à¸£à¹‡à¸ˆ!', text: apiResult.message, icon: 'success', timer: 2000, showConfirmButton: false });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  voteForm.reset();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  studentIdMsg.textContent = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  studentIdMsg.className = 'message';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.design-card').forEach(card => card.classList.remove('selected'));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  validateForm();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  designOptionsDiv.classList.add('disabled');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  loadInitialData();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Swal.fire({ title: 'à¸œà¸´à¸”à¸à¸¥à¸²à¸”!', text: apiResult.message, icon: 'error' });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (apiResult.message.includes('à¹‚à¸«à¸§à¸•à¹„à¸›à¹à¸¥à¹‰à¸§')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â studentIdInput.dispatchEvent(new Event('blur'));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });

Â  Â  Â  Â  designOptionsDiv.addEventListener('change', (event) => {
Â  Â  Â  Â  Â  Â  if (event.target.name === 'voteChoice') {
Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.design-card').forEach(card => card.classList.remove('selected'));
Â  Â  Â  Â  Â  Â  Â  Â  const selectedCard = event.target.closest('.design-card');
Â  Â  Â  Â  Â  Â  Â  Â  if (selectedCard) selectedCard.classList.add('selected');
Â  Â  Â  Â  Â  Â  Â  Â  validateForm();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  function validateForm() {
Â  Â  Â  Â  Â  Â  const studentId = studentIdInput.value;
Â  Â  Â  Â  Â  Â  const fullName = fullNameInput.value;
Â  Â  Â  Â  Â  Â  const choiceRadio = document.querySelector('input[name="voteChoice"]:checked');
Â  Â  Â  Â  Â  Â  submitVoteButton.disabled = !(studentId.length === 5 && fullName.trim() !== '' && choiceRadio);
Â  Â  Â  Â  }

Â  Â  Â  Â  async function callApi(action, data = {}) {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(WEB_APP_URL, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'text/plain;charset=utf-8' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify({ action, ...data }),
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
Â  Â  Â  Â  Â  Â  Â  Â  return await response.json();
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error calling API:', error);
Â  Â  Â  Â  Â  Â  Â  Â  return { status: 'error', message: 'à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”à¹ƒà¸™à¸à¸²à¸£à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­: ' + error.message };
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  async function loadInitialData() {
Â  Â  Â  Â  Â  Â  showSkeletonLoader();
Â  Â  Â  Â  Â  Â  validateForm();
Â  Â  Â  Â  Â  Â  const resultsData = await callApi('getVoteResults');
Â  Â  Â  Â  Â  Â  if (resultsData.status === 'success' && resultsData.results) {
Â  Â  Â  Â  Â  Â  Â  Â  displayDesignOptions(resultsData.results);
Â  Â  Â  Â  Â  Â  Â  Â  displayVoteResults(resultsData.results);
Â  Â  Â  Â  Â  Â  Â  Â  displayVoteChart(resultsData.results);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  designOptionsDiv.innerHTML = `<p class="message error">à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹‚à¸«à¸¥à¸”à¹à¸šà¸šà¹€à¸ªà¸·à¹‰à¸­à¹„à¸”à¹‰</p>`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  checkVotingStatus();
Â  Â  Â  Â  Â  Â  await getAnnouncementText();
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function displayDesignOptions(designs) {
Â  Â  Â  Â  Â  Â  designOptionsDiv.innerHTML = '';
Â  Â  Â  Â  Â  Â  if (designs.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  designOptionsDiv.innerHTML = '<p class="message">à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¹à¸šà¸šà¹€à¸ªà¸·à¹‰à¸­à¹ƒà¸«à¹‰à¹‚à¸«à¸§à¸•</p>';
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  designs.forEach(design => {
Â  Â  Â  Â  Â  Â  Â  Â  const div = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  div.classList.add('design-card');
Â  Â  Â  Â  Â  Â  Â  Â  div.innerHTML = `<input type="radio" id="design-${design.designId}" name="voteChoice" value="${design.designId}" required><label for="design-${design.designId}"><img src="${design.imageUrl || 'https://via.placeholder.com/150?text=No+Image'}" alt="${design.designName}">${design.designName}</label>`;
Â  Â  Â  Â  Â  Â  Â  Â  designOptionsDiv.appendChild(div);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function updateSelectedDesignCard(selectedDesignId) {
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.design-card').forEach(card => card.classList.remove('selected'));
Â  Â  Â  Â  Â  Â  if (selectedDesignId) {
Â  Â  Â  Â  Â  Â  Â  Â  const selectedCard = document.querySelector(`.design-card[data-design-id="${selectedDesignId}"]`);
Â  Â  Â  Â  Â  Â  Â  Â  if (selectedCard) selectedCard.classList.add('selected');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function displayVoteResults(results) {
Â  Â  Â  Â  Â  Â  const voteResultsDiv = document.getElementById('vote-results');
Â  Â  Â  Â  Â  Â  if(!voteResultsDiv) return;
Â  Â  Â  Â  Â  Â  voteResultsDiv.innerHTML = '';
Â  Â  Â  Â  Â  Â  if (results.length === 0) { voteResultsDiv.innerHTML = '<p class="message">à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸œà¸¥à¸à¸²à¸£à¹‚à¸«à¸§à¸•</p>'; return; }
Â  Â  Â  Â  Â  Â  results.sort((a, b) => b.voteCount - a.voteCount);
Â  Â  Â  Â  Â  Â  results.forEach(item => {
Â  Â  Â  Â  Â  Â  Â  Â  const div = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  div.classList.add('vote-item');
Â  Â  Â  Â  Â  Â  Â  Â  div.innerHTML = `<span>à¹à¸šà¸šà¹€à¸ªà¸·à¹‰à¸­ ${item.designId} (${item.designName}):</span><span class="vote-count">${item.voteCount} à¸„à¸°à¹à¸™à¸™</span>`;
Â  Â  Â  Â  Â  Â  Â  Â  voteResultsDiv.appendChild(div);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function displayVoteChart(votes) {
Â  Â  Â  Â  Â  Â  const voteChartCanvas = document.getElementById('voteChart');
Â  Â  Â  Â  Â  Â  if(!voteChartCanvas) return;
Â  Â  Â  Â  Â  Â  const ctx = voteChartCanvas.getContext('2d');
Â  Â  Â  Â  Â  Â  if (votes.length === 0) { if (voteChartInstance) voteChartInstance.destroy(); return; }
Â  Â  Â  Â  Â  Â  const labels = votes.map(v => `à¹à¸šà¸š ${v.designId}`);
Â  Â  Â  Â  Â  Â  const data = votes.map(v => v.voteCount);
Â  Â  Â  Â  Â  Â  const backgroundColors = data.map(() => `rgba(${Math.floor(Math.random()*255)},${Math.floor(Math.random()*255)},${Math.floor(Math.random()*255)},0.7)`);
Â  Â  Â  Â  Â  Â  if (voteChartInstance) voteChartInstance.destroy();
Â  Â  Â  Â  Â  Â  voteChartInstance = new Chart(ctx, {
Â  Â  Â  Â  Â  Â  Â  Â  type: 'bar',
Â  Â  Â  Â  Â  Â  Â  Â  data: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  labels: labels,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  datasets: [{ label: 'à¸„à¸°à¹à¸™à¸™à¹‚à¸«à¸§à¸•', data: data, backgroundColor: backgroundColors }]
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  options: { responsive: true, maintainAspectRatio: false }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  async function getAnnouncementText() {
Â  Â  Â  Â  Â  Â  const result = await callApi('getAnnouncementText');
Â  Â  Â  Â  Â  Â  if (result.status === 'success') {
Â  Â  Â  Â  Â  Â  Â  Â  const announcementBar = document.querySelector('.announcement-bar .scrolling-text');
Â  Â  Â  Â  Â  Â  Â  Â  if (announcementBar) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  announcementBar.textContent = result.text;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  async function checkVotingStatus() {
Â  Â  Â  Â  Â  Â  const response = await callApi('getVoteTime');
Â  Â  Â  Â  Â  Â  if (response.status === 'success') {
Â  Â  Â  Â  Â  Â  Â  Â  const now = new Date();
Â  Â  Â  Â  Â  Â  Â  Â  const startDateTime = response.startTime ? new Date(response.startTime) : null;
Â  Â  Â  Â  Â  Â  Â  Â  const endDateTime = response.endTime ? new Date(response.endTime) : null;
Â  Â  Â  Â  Â  Â  Â  Â  clearInterval(countdownInterval);
Â  Â  Â  Â  Â  Â  Â  Â  countdownTimerDiv.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  if ((startDateTime && now < startDateTime) || (endDateTime && now > endDateTime)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  registrationFormSection.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  resultsSection.style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (startDateTime && now < startDateTime) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  votingStatusDiv.textContent = 'ğŸ”´ à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸–à¸¶à¸‡à¹€à¸§à¸¥à¸²à¹€à¸›à¸´à¸”à¹‚à¸«à¸§à¸• à¸ˆà¸°à¹€à¸›à¸´à¸”à¹ƒà¸™à¸­à¸µà¸';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  countdownTimerDiv.style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  startCountdown(startDateTime.getTime());
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  votingStatusDiv.textContent = `ğŸ”´ à¸›à¸´à¸”à¸£à¸±à¸šà¸à¸²à¸£à¹‚à¸«à¸§à¸•à¹à¸¥à¹‰à¸§`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  votingStatusDiv.className = 'status-message closed';
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  registrationFormSection.style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  resultsSection.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (startDateTime && endDateTime) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  votingStatusDiv.textContent = 'ğŸŸ¢ à¹€à¸›à¸´à¸”à¹ƒà¸«à¹‰à¹‚à¸«à¸§à¸•à¹à¸¥à¹‰à¸§ à¸ˆà¸°à¸›à¸´à¸”à¹ƒà¸™à¸­à¸µà¸';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  countdownTimerDiv.style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  startCountdown(endDateTime.getTime());
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  votingStatusDiv.textContent = 'ğŸŸ¢ à¹€à¸›à¸´à¸”à¹ƒà¸«à¹‰à¹‚à¸«à¸§à¸•à¹à¸¥à¹‰à¸§';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  votingStatusDiv.className = 'status-message open';
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function startCountdown(targetTime) {
Â  Â  Â  Â  Â  Â  clearInterval(countdownInterval);
Â  Â  Â  Â  Â  Â  const updateCountdown = () => {
Â  Â  Â  Â  Â  Â  Â  Â  const distance = targetTime - new Date().getTime();
Â  Â  Â  Â  Â  Â  Â  Â  if (distance < 1000) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  clearInterval(countdownInterval);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  countdownTimerDiv.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  loadInitialData();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  const days = Math.floor(distance / (1000 * 60 * 60 * 24));
Â  Â  Â  Â  Â  Â  Â  Â  const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
Â  Â  Â  Â  Â  Â  Â  Â  const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
Â  Â  Â  Â  Â  Â  Â  Â  const seconds = Math.floor((distance % (1000 * 60)) / 1000);
Â  Â  Â  Â  Â  Â  Â  Â  countdownTimerDiv.innerHTML = `<span>${days}</span> à¸§à¸±à¸™ <span>${hours}</span> à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡ <span>${minutes}</span> à¸™à¸²à¸—à¸µ <span>${seconds}</span> à¸§à¸´à¸™à¸²à¸—à¸µ`;
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  updateCountdown();
Â  Â  Â  Â  Â  Â  countdownInterval = setInterval(updateCountdown, 1000);
Â  Â  Â  Â  }

Â  Â  Â  Â  loadInitialData();

Â  Â  Â  Â  window.addEventListener('load', () => {
Â  Â  Â  Â  Â  Â  Swal.fire({
Â  Â  Â  Â  Â  Â  Â  Â  title: 'à¸§à¸´à¸˜à¸µà¸à¸²à¸£à¹‚à¸«à¸§à¸•à¸‡à¹ˆà¸²à¸¢à¹† à¹ƒà¸™ 3 à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™',
Â  Â  Â  Â  Â  Â  Â  Â  html: `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ol style="text-align: left; margin: 0 auto; display: inline-block;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li><strong>à¸à¸£à¸­à¸à¸£à¸«à¸±à¸ªà¸™à¸±à¸à¹€à¸£à¸µà¸¢à¸™:</strong> à¹ƒà¸ªà¹ˆà¸£à¸«à¸±à¸ªà¸‚à¸­à¸‡à¸„à¸¸à¸“à¹€à¸à¸·à¹ˆà¸­à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸ªà¸´à¸—à¸˜à¸´à¹Œ</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li><strong>à¹€à¸¥à¸·à¸­à¸à¸£à¸–à¹à¸‚à¹ˆà¸‡:</strong> à¸„à¸¥à¸´à¸à¹€à¸¥à¸·à¸­à¸à¹à¸šà¸šà¹€à¸ªà¸·à¹‰à¸­à¸—à¸µà¹ˆà¸„à¸¸à¸“à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¹‚à¸«à¸§à¸•</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li><strong>à¸¢à¸·à¸™à¸¢à¸±à¸™à¸à¸²à¸£à¹‚à¸«à¸§à¸•:</strong> à¸à¸”à¸›à¸¸à¹ˆà¸¡à¸¢à¸·à¸™à¸¢à¸±à¸™à¹€à¸à¸·à¹ˆà¸­à¸ªà¹ˆà¸‡à¸„à¸°à¹à¸™à¸™</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ol>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p style="margin-top: 15px;">à¹à¸„à¹ˆà¸™à¸µà¹‰à¸à¹‡à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢! à¹‚à¸›à¸£à¸”à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸«à¹‰à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡à¸à¹ˆà¸­à¸™à¸¢à¸·à¸™à¸¢à¸±à¸™à¸™à¸°à¸„à¸£à¸±à¸š</p>
Â  Â  Â  Â  Â  Â  Â  Â  `,
Â  Â  Â  Â  Â  Â  Â  Â  icon: 'info',
Â  Â  Â  Â  Â  Â  Â  Â  showConfirmButton: true,
Â  Â  Â  Â  Â  Â  Â  Â  confirmButtonText: 'à¹€à¸‚à¹‰à¸²à¹ƒà¸ˆà¹à¸¥à¹‰à¸§',
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });
Â  Â  </script>
</body>
</html>
